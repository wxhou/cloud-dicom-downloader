# 项目 上下文

## 目的
医疗云影像下载器，用于从在线报告系统下载CT、MRI等医疗影像的DICOM文件。支持多个医院的在线影像平台，为用户提供便捷的医疗影像下载和本地查看解决方案。

## 技术栈
- **Python 3.x** - 主要开发语言
- **asyncio** - 异步编程框架
- **yarl** - URL解析和处理
- **playwright** - 浏览器自动化，用于处理JavaScript渲染的复杂页面
- **aiohttp** - 异步HTTP客户端
- **pydicom** - DICOM医疗影像文件处理
- **pycryptodomex** - 加密解密功能
- **loguru** - 结构化日志记录
- **tqdm** - 进度条显示
- **PyInstaller** - 打包为独立可执行文件

## 项目约定

### 代码风格
- 使用现代Python特性（async/await、类型提示、f-string）
- 模块化设计，每个医院网站对应独立爬虫模块
- 统一的日志记录机制，使用loguru进行结构化日志
- 函数和变量命名遵循PEP 8规范
- 优先使用中文注释和文档

#### Python导入库规范

**导入顺序**：
1. 标准库导入（asyncio, sys, json等）
2. 第三方库导入（aiohttp, yarl, playwright等）
3. 项目内部模块导入（crawlers.*, tools.*）

**导入规则**：
- 使用绝对导入，避免相对导入
- 按字母顺序排列同组内导入项
- 避免 `from module import *`
- 多项导入使用括号格式换行
- 保持一致的缩进和对齐

**测试代码管理**：
- 超过5行的测试代码必须使用Python测试脚本
- 测试脚本统一放在项目的 `tmp` 目录中
- 临时脚本使用有意义的文件名，避免无意义的名称
- 测试完成后根据需要决定是否保留或清理
- 避免在主代码目录中遗留临时测试文件

### 架构模式
- **插件化爬虫架构**：每个支持的医院网站对应一个独立的爬虫模块
- **统一接口模式**：所有爬虫模块遵循相同的接口规范
- **异步处理**：使用asyncio实现高并发下载
- **错误处理**：完善的异常处理和用户友好的错误提示

### 测试策略
- 使用pytest作为测试框架
- 单元测试覆盖核心工具函数
- 集成测试验证完整下载流程
- 测试用例包括模拟数据和真实场景测试

### Git工作流
- 使用语义化版本控制
- 特性分支开发模式
- 提交信息遵循约定式提交规范
- 代码审查流程确保代码质量

## 领域上下文
- **医疗影像标准**：深入理解DICOM文件格式和医疗影像存储标准
- **医院信息系统**：熟悉国内各大医院使用的不同影像平台和API
- **医疗数据隐私**：遵守医疗数据处理的相关法规和隐私保护要求
- **浏览器自动化**：掌握复杂医疗网站的前端技术栈和反爬机制

## 重要约束
- **法律合规**：仅用于个人医疗影像备份，不用于商业用途
- **技术限制**：部分医院系统不提供原始文件下载功能
- **性能要求**：需要处理大文件下载和长时间运行的爬取任务
- **兼容性**：支持主流操作系统（Windows、macOS、Linux）

## 外部依赖
- **医疗影像平台**：12个不同的医院在线影像系统
- **浏览器引擎**：playwright支持的Chromium、Firefox、WebKit
- **Python包管理**：pip/conda生态系统
- **医疗影像查看软件**：第三方DICOM查看器（用户可选）
